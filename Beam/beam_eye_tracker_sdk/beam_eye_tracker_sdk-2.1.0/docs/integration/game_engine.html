<!DOCTYPE html>

<html :class="{'dark': darkMode === 'dark' || (darkMode === 'system' &amp;&amp; window.matchMedia('(prefers-color-scheme: dark)').matches)}" class="scroll-smooth" data-content_root="../" lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') || localStorage.setItem('darkMode', 'system'), activeSection: '' }" x-init="$watch('darkMode', val =&gt; localStorage.setItem('darkMode', val))">
<head>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta charset="utf-8"/>
<meta content="white" media="(prefers-color-scheme: light)" name="theme-color"/>
<meta content="black" media="(prefers-color-scheme: dark)" name="theme-color"/>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<title>Game Engine Integration | Beam Eye Tracker SDK</title>
<meta content="Game Engine Integration | Beam Eye Tracker SDK" property="og:title"/>
<meta content="Game Engine Integration | Beam Eye Tracker SDK" name="twitter:title"/>
<link href="../_static/pygments.css?v=03e43079" rel="stylesheet" type="text/css"/>
<link href="../_static/theme.css?v=42baaae4" rel="stylesheet" type="text/css"/>
<link href="../_static/sphinx-design.min.css?v=95c83b7e" rel="stylesheet" type="text/css"/>
<link href="../_static/css/custom.css?v=5310992a" rel="stylesheet" type="text/css"/>
<link href="../_static/awesome-sphinx-design.css?v=15e0fffa" rel="stylesheet" type="text/css"/>
<link href="../search.html" rel="search" title="Search"/>
<link href="../genindex.html" rel="index" title="Index"/>
<link href="unity.html" rel="next" title="Unity Package"/>
<link href="integration.html" rel="prev" title="Plugins and samples"/>
<script>
    <!-- Prevent Flash of wrong theme -->
      const userPreference = localStorage.getItem('darkMode');
      let mode;
      if (userPreference === 'dark' || window.matchMedia('(prefers-color-scheme: dark)').matches) {
        mode = 'dark';
        document.documentElement.classList.add('dark');
      } else {
        mode = 'light';
      }
      if (!userPreference) {localStorage.setItem('darkMode', mode)}
    </script>
</head>
<body :class="{ 'overflow-hidden': showSidebar }" class="min-h-screen font-sans antialiased bg-background text-foreground" x-data="{ showSidebar: false, showScrollTop: false }">
<div @click.self="showSidebar = false" class="fixed inset-0 z-50 overflow-hidden bg-background/80 backdrop-blur-sm md:hidden" x-cloak="" x-show="showSidebar"></div><div class="relative flex flex-col min-h-screen" id="page"><a class="absolute top-0 left-0 z-[100] block bg-background p-4 text-xl transition -translate-x-full opacity-0 focus:translate-x-0 focus:opacity-100" href="#content">
      Skip to content
    </a><header class="sticky top-0 z-40 w-full border-b shadow-sm border-border supports-backdrop-blur:bg-background/60 bg-background/95 backdrop-blur"><div class="container flex items-center h-14">
<div class="hidden mr-4 md:flex">
<a class="flex items-center mr-6" href="../index.html">
<img alt="Logo" class="mr-2 hidden dark:block" height="24" src="../_static/BeamIconDark.svg" width="24"/>
<img alt="Logo" class="mr-2 dark:hidden" height="24" src="../_static/BeamIconLight.svg" width="24"/><span class="hidden font-bold sm:inline-block text-clip whitespace-nowrap">Beam Eye Tracker SDK</span>
</a><nav class="flex items-center space-x-6 text-sm font-medium">
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="../index.html">Documentation</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="https://beam.eyeware.tech/" rel="noopener nofollow">Website</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="https://discord.gg/dqm2KbFWJd" rel="noopener nofollow">Community</a>
<a class="transition-colors hover:text-foreground/80 text-foreground/60" href="https://beameyetrackersdk.featurebase.app/" rel="noopener nofollow">Feature Requests</a>
</nav></div><button @click="showSidebar = true" class="inline-flex items-center justify-center h-10 px-0 py-2 mr-2 text-base font-medium transition-colors rounded-md hover:text-accent-foreground hover:bg-transparent md:hidden" type="button">
<svg aria-hidden="true" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M152.587 825.087q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440Zm0-203.587q-19.152 0-32.326-13.174T107.087 576q0-19.152 13.174-32.326t32.326-13.174h320q19.152 0 32.326 13.174T518.087 576q0 19.152-13.174 32.326T472.587 621.5h-320Zm0-203.587q-19.152 0-32.326-13.174t-13.174-32.326q0-19.152 13.174-32.326t32.326-13.174h440q19.152 0 32.326 13.174t13.174 32.326q0 19.152-13.174 32.326t-32.326 13.174h-440ZM708.913 576l112.174 112.174q12.674 12.674 12.674 31.826t-12.674 31.826Q808.413 764.5 789.261 764.5t-31.826-12.674l-144-144Q600 594.391 600 576t13.435-31.826l144-144q12.674-12.674 31.826-12.674t31.826 12.674q12.674 12.674 12.674 31.826t-12.674 31.826L708.913 576Z"></path>
</svg>
<span class="sr-only">Toggle navigation menu</span>
</button>
<div class="flex items-center justify-between flex-1 space-x-2 sm:space-x-4 md:justify-end">
<div class="flex-1 w-full md:w-auto md:flex-none"><form @keydown.k.window.meta="$refs.search.focus()" action="../search.html" class="relative flex items-center group" id="searchbox" method="get">
<input aria-label="Search the docs" class="inline-flex items-center font-medium transition-colors bg-transparent focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ring-offset-background border border-input hover:bg-accent focus:bg-accent hover:text-accent-foreground focus:text-accent-foreground hover:placeholder-accent-foreground py-2 px-4 relative h-9 w-full justify-start rounded-[0.5rem] text-sm text-muted-foreground sm:pr-12 md:w-40 lg:w-64" id="search-input" name="q" placeholder="Search ..." type="search" x-ref="search"/>
<kbd class="pointer-events-none absolute right-1.5 top-2 hidden h-5 select-none text-muted-foreground items-center gap-1 rounded border border-border bg-muted px-1.5 font-mono text-[10px] font-medium opacity-100 sm:flex group-hover:bg-accent group-hover:text-accent-foreground">
<span class="text-xs">⌘</span>
    K
  </kbd>
</form>
</div>
<nav class="flex items-center space-x-1">
<a href="https://discord.gg/dqm2KbFWJd" rel="noopener nofollow" title="Visit Discord server">
<div class="inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md disabled:opacity-50 disabled:pointer-events-none hover:bg-accent hover:text-accent-foreground h-9 w-9">
<svg fill="currentColor" height="26px" style="margin-top:-2px" version="1.1" viewbox="0 0 45 44" xmlns="http://www.w3.org/2000/svg">
<defs>
<clippath id="clipPath867-5">
<rect fill="#fff" height="14" width="14"></rect>
</clippath>
</defs>currentColor"/&gt;
 <path clip-path="url(#clipPath867-5)" d="m11.859 2.8375c-0.92283-0.39823-1.8959-0.67932-2.8884-0.83748-0.22095 0.38392-0.32405 0.89795-0.86921 0.64912-0.90018-0.087567-1.8108-0.067558-2.7062 0.059678-0.16389-0.4583-0.3914-0.89458-0.92847-0.60578-0.79938 0.16661-1.5822 0.41322-2.332 0.73654-1.4787 2.0097-2.3055 4.5211-2.1133 7.0246-0.043179 0.82883 1.0658 0.97913 1.6218 1.3878 0.64192 0.21276 1.474 0.83636 2.0642 0.61062 0.17349-0.37226 1.0329-1.0588 0.26873-1.1622-0.26836-0.1646-1.1475-0.33602-0.51788-0.59849 2.2221 0.99281 4.8605 0.9928 7.0826 0 0.66288 0.32808-0.52789 0.52761-0.82643 0.71839 0.00147 0.28353 0.44882 1.0618 0.80032 1.1451 1.2193-0.35975 2.3822-0.91317 3.4253-1.6404 0.30843-2.6579-0.48843-5.3511-2.0811-7.4875zm-7.185 5.9797c-0.95014 0.025347-1.5708-1.1416-1.1115-1.9455 0.35701-0.80833 1.5813-0.933 2.0917-0.2109 0.65829 0.7909 0.087727 2.1792-0.98017 2.1564zm4.6513 0c-0.9505 0.025815-1.5693-1.1422-1.1104-1.9455 0.35686-0.80745 1.5818-0.93406 2.0911-0.2109 0.65473 0.79144 0.087254 2.179-0.98076 2.1564z" fill="#5865f2" transform="matrix(3.0396 0 0 3.0396 1.2231 .7756)"></path>
</svg>
</div>
</a>
<button @click="darkMode = darkMode === 'light' ? 'dark' : 'light'" aria-label="Color theme switcher" class="relative inline-flex items-center justify-center px-0 text-sm font-medium transition-colors rounded-md hover:bg-accent hover:text-accent-foreground h-9 w-9" type="button">
<svg class="absolute transition-all scale-100 rotate-0 dark:-rotate-90 dark:scale-0" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 685q45.456 0 77.228-31.772Q589 621.456 589 576q0-45.456-31.772-77.228Q525.456 467 480 467q-45.456 0-77.228 31.772Q371 530.544 371 576q0 45.456 31.772 77.228Q434.544 685 480 685Zm0 91q-83 0-141.5-58.5T280 576q0-83 58.5-141.5T480 376q83 0 141.5 58.5T680 576q0 83-58.5 141.5T480 776ZM80 621.5q-19.152 0-32.326-13.174T34.5 576q0-19.152 13.174-32.326T80 530.5h80q19.152 0 32.326 13.174T205.5 576q0 19.152-13.174 32.326T160 621.5H80Zm720 0q-19.152 0-32.326-13.174T754.5 576q0-19.152 13.174-32.326T800 530.5h80q19.152 0 32.326 13.174T925.5 576q0 19.152-13.174 32.326T880 621.5h-80Zm-320-320q-19.152 0-32.326-13.174T434.5 256v-80q0-19.152 13.174-32.326T480 130.5q19.152 0 32.326 13.174T525.5 176v80q0 19.152-13.174 32.326T480 301.5Zm0 720q-19.152 0-32.326-13.17Q434.5 995.152 434.5 976v-80q0-19.152 13.174-32.326T480 850.5q19.152 0 32.326 13.174T525.5 896v80q0 19.152-13.174 32.33-13.174 13.17-32.326 13.17ZM222.174 382.065l-43-42Q165.5 327.391 166 308.239t13.174-33.065q13.435-13.674 32.587-13.674t32.065 13.674l42.239 43q12.674 13.435 12.555 31.706-.12 18.272-12.555 31.946-12.674 13.674-31.445 13.413-18.772-.261-32.446-13.174Zm494 494.761-42.239-43q-12.674-13.435-12.674-32.087t12.674-31.565Q686.609 756.5 705.38 757q18.772.5 32.446 13.174l43 41.761Q794.5 824.609 794 843.761t-13.174 33.065Q767.391 890.5 748.239 890.5t-32.065-13.674Zm-42-494.761Q660.5 369.391 661 350.62q.5-18.772 13.174-32.446l41.761-43Q728.609 261.5 747.761 262t33.065 13.174q13.674 13.435 13.674 32.587t-13.674 32.065l-43 42.239q-13.435 12.674-31.706 12.555-18.272-.12-31.946-12.555Zm-495 494.761Q165.5 863.391 165.5 844.239t13.674-32.065l43-42.239q13.435-12.674 32.087-12.674t31.565 12.674Q299.5 782.609 299 801.38q-.5 18.772-13.174 32.446l-41.761 43Q231.391 890.5 212.239 890t-33.065-13.174ZM480 576Z"></path>
</svg>
<svg class="absolute transition-all scale-0 rotate-90 dark:rotate-0 dark:scale-100" fill="currentColor" height="24" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 936q-151 0-255.5-104.5T120 576q0-138 90-239.5T440 218q25-3 39 18t-1 44q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q21-14 43-1.5t19 39.5q-14 138-117.5 229T480 936Zm0-80q88 0 158-48.5T740 681q-20 5-40 8t-40 3q-123 0-209.5-86.5T364 396q0-20 3-40t8-40q-78 32-126.5 102T200 576q0 116 82 198t198 82Zm-10-270Z"></path>
</svg>
</button>
</nav>
</div>
</div>
</header>
<div class="flex-1"><div class="container flex-1 items-start md:grid md:grid-cols-[220px_minmax(0,1fr)] md:gap-6 lg:grid-cols-[240px_minmax(0,1fr)] lg:gap-10"><aside :aria-hidden="!showSidebar" :class="{ 'translate-x-0': showSidebar }" class="fixed inset-y-0 left-0 md:top-14 z-50 md:z-30 bg-background md:bg-transparent transition-all duration-100 -translate-x-full md:translate-x-0 ml-0 p-6 md:p-0 md:-ml-2 md:h-[calc(100vh-3.5rem)] w-5/6 md:w-full shrink-0 overflow-y-auto border-r border-border md:sticky" id="left-sidebar">
<a class="!justify-start text-sm md:!hidden bg-background" href="../index.html">
<img alt="Logo" class="mr-2 hidden dark:block" height="16" src="../_static/BeamIconDark.svg" width="16"/>
<img alt="Logo" class="mr-2 dark:hidden" height="16" src="../_static/BeamIconLight.svg" width="16"/><span class="font-bold text-clip whitespace-nowrap">Beam Eye Tracker SDK</span>
</a>
<div class="relative overflow-hidden md:overflow-auto my-4 md:my-0 h-[calc(100vh-8rem)] md:h-auto">
<div class="overflow-y-auto h-full w-full relative pr-6"><nav class="flex md:hidden flex-col font-medium mt-4">
<a href="../index.html">Documentation</a>
<a href="https://beam.eyeware.tech/" rel="nofollow noopener">Website</a>
<a href="https://discord.gg/dqm2KbFWJd" rel="nofollow noopener">Community</a>
<a href="https://beameyetrackersdk.featurebase.app/" rel="nofollow noopener">Feature Requests</a>
</nav><nav class="table w-full min-w-full my-6 lg:my-8">
<ul class="current">
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../basics/index.html">Start with the basics<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../basics/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/installation.html">Installation &amp; Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/general_api_concepts.html">General API concepts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../basics/reference_frames.html">Reference frames</a></li>
</ul>
</li>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../features/features.html">Core features<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../features/user_tracking.html">Real-time tracking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/sim_game_camera.html">In-game camera control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/game_immersive_hud.html">Dynamic HUDs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../features/foveated_rendering.html">Foveated rendering</a></li>
</ul>
</li>
<li class="toctree-l1 current" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="integration.html">Plugins and samples<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul class="current" x-show="expanded">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Game Engine Integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="unity.html">Unity Package</a></li>
<li class="toctree-l2"><a class="reference internal" href="fidelityfx.html">Foveated Rendering using FidelityFX™</a></li>
</ul>
</li>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../api/index.html">API Reference<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../api/cpp/index.html">C++</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/c/index.html">C</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/python/index.html">Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api/csharp/index.html">C#</a></li>
</ul>
</li>
<li class="toctree-l1" x-data="{ expanded: $el.classList.contains('current') ? true : false }"><a :class="{ 'expanded' : expanded }" @click="expanded = !expanded" class="reference internal expandable" href="../info/info.html">Versioning &amp; Legal<button @click.prevent.stop="expanded = !expanded" type="button"><span class="sr-only"></span><svg fill="currentColor" height="18px" stroke="none" viewbox="0 0 24 24" width="18px" xmlns="http://www.w3.org/2000/svg"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"></path></svg></button></a><ul x-show="expanded">
<li class="toctree-l2"><a class="reference internal" href="../info/changelog.html">Changelog</a></li>
<li class="toctree-l2"><a class="reference internal" href="../info/third-party-licenses.html">Third Party Licenses</a></li>
<li class="toctree-l2"><a class="reference internal" href="../info/license.html">License</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
<button @click="showSidebar = false" class="absolute md:hidden right-4 top-4 rounded-sm opacity-70 transition-opacity hover:opacity-100" type="button">
<svg class="h-4 w-4" fill="currentColor" height="24" stroke="none" viewbox="0 96 960 960" width="24" xmlns="http://www.w3.org/2000/svg">
<path d="M480 632 284 828q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536 576l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480 632Z"></path>
</svg>
</button>
</aside>
<main class="relative py-6 lg:gap-10 lg:py-8 xl:grid xl:grid-cols-[1fr_300px]">
<div class="w-full min-w-0 mx-auto">
<nav aria-label="breadcrumbs" class="flex items-center mb-4 space-x-1 text-sm text-muted-foreground">
<a class="overflow-hidden text-ellipsis whitespace-nowrap hover:text-foreground" href="../index.html">
<span class="hidden md:inline">Beam Eye Tracker SDK</span>
<svg aria-label="Home" class="md:hidden" fill="currentColor" height="18" stroke="none" viewbox="0 96 960 960" width="18" xmlns="http://www.w3.org/2000/svg">
<path d="M240 856h120V616h240v240h120V496L480 316 240 496v360Zm-80 80V456l320-240 320 240v480H520V696h-80v240H160Zm320-350Z"></path>
</svg>
</a>
<div class="mr-1">/</div><a class="hover:text-foreground overflow-hidden text-ellipsis whitespace-nowrap" href="integration.html">Plugins and samples</a>
<div class="mr-1">/</div><span aria-current="page" class="font-medium text-foreground overflow-hidden text-ellipsis whitespace-nowrap">Game Engine Integration</span>
</nav>
<div id="content" role="main">
<section id="game-engine-integration">
<span id="id1"></span><h1>Game Engine Integration<a class="headerlink" href="#game-engine-integration" title="Link to this heading"><span>¶</span></a></h1>
<p>The Game Engine Integration Sample demonstrates how to integrate the Beam Eye Tracker SDK into a game engine architecture.
To avoid dealing with the many complexities of a real game-engine, this sample uses a dummy game engine architecture.
However, the coding patterns are compatible with major game engines like Unity and Unreal Engine 5. It demonstrates:</p>
<ul class="simple">
<li><p>Wrapping the <code class="docutils literal notranslate"><span class="pre">API</span></code> as a custom game engine input device;</p></li>
<li><p>Implementation of <a class="reference internal" href="../features/sim_game_camera.html#about-sim-game-camera-state"><span class="std std-ref">In-game camera control</span></a>;</p></li>
<li><p>Implementation of an Immersive HUD as in <a class="reference internal" href="../features/game_immersive_hud.html#about-game-immersive-hud-state"><span class="std std-ref">Dynamic HUDs</span></a>;</p></li>
<li><p>Holding game settings parameters and mapping them to input device parameters;</p></li>
<li><p>Viewport geometry management;</p></li>
<li><p>Camera recentering functionality, and;</p></li>
<li><p>Auto-start capability for seamless user experience.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Requirements</strong>: Windows 10 or higher, CMake, C++ compiler, Beam Eye Tracker application (v2.4 or higher).</p>
<p><strong>Language</strong>: <code class="docutils literal notranslate"><span class="pre">C++</span></code>.</p>
</div>
<section id="compiling-and-running-the-sample">
<h2>Compiling and running the sample<a class="headerlink" href="#compiling-and-running-the-sample" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#compiling-and-running-the-sample'"><span>¶</span></a></h2>
<p>As part of the <cite>C++</cite> samples, you can find the <code class="docutils literal notranslate"><span class="pre">game_engine_integration</span></code> sample in the <code class="docutils literal notranslate"><span class="pre">cpp\samples</span></code> folder.</p>
<p>Prebuilt binaries are available for Windows in the <code class="docutils literal notranslate"><span class="pre">cpp\samples\bin</span></code> folder. But you can also compile the sample yourself.
To do so, run the <code class="docutils literal notranslate"><span class="pre">build_samples.bat</span></code> script in the <code class="docutils literal notranslate"><span class="pre">cpp\samples</span></code> folder.
The script assumes you have CMake installed and that CMake can find a suitable
C++ compiler/generator on your system. The <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code> integrates the Beam Eye Tracker SDK as explained in <a class="reference internal" href="../basics/installation.html#beam-sdk-integration-project-configuration"><span class="std std-ref">Project configuration</span></a>.</p>
<p>The program runs for 30 seconds. The console displays:</p>
<ul class="simple">
<li><p>Real-time camera position and rotation (only z translation and yaw are shown for simplicity);</p></li>
<li><p>Current HUD opacity values which change whether you are looking at the top-left corner of the viewport, and;</p></li>
<li><p>Recentering status updates (when pressing SPACE).</p></li>
</ul>
<p>Moreover, you can observe that the camera’s z translation continuously increases
to simulate the <code class="docutils literal notranslate"><span class="pre">reference</span></code> camera pose changes through the 3D world scene,
while the immersive camera pose changes are <cite>additive</cite> to this base pose.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The current <strong>viewport</strong> geometry is hardcoded in <code class="docutils literal notranslate"><span class="pre">get_rendering_area_viewport_geometry_from_engine</span></code> and thus you won’t
experience realistic behavior out of the box when running the sample. It
assumes the game is rendering on the middle screen of three 1920x1080 monitors, with the left-most screen being the Windows <cite>main display</cite>.</p>
<p>If you want realistic behavior, for example, that the opacitiy output changes when you indeed look at the top-left corner
of YOUR display, you need to modify the <code class="docutils literal notranslate"><span class="pre">get_rendering_area_viewport_geometry_from_engine</span></code> function to return
a rectangle geometry that matches your setup (e.g. a given screen or window that you want to pretend is game-rendering area),
but do respect the Unity-like viewport definition (bottom-left corner at <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code>) which is assumed for this specific sample.</p>
</div>
</section>
<section id="sample-explained">
<h2>Sample explained<a class="headerlink" href="#sample-explained" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#sample-explained'"><span>¶</span></a></h2>
<p>The source code is distributed into three files:</p>
<section id="my-game-engine-h">
<h3>my_game_engine.h<a class="headerlink" href="#my-game-engine-h" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#my-game-engine-h'"><span>¶</span></a></h3>
<p>This file implements dummy classes that emulate a typical game engine object-oriented pattern:</p>
<ul class="simple">
<li><p>Base interfaces with common functions like <code class="docutils literal notranslate"><span class="pre">BeginPlay</span></code>, <code class="docutils literal notranslate"><span class="pre">Tick</span></code>, <code class="docutils literal notranslate"><span class="pre">Update</span></code></p></li>
<li><p>Simplified game engine architecture similar to Unity/Unreal</p></li>
<li><p>Meant to be replaced by your engine’s actual functionality</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">my_game_engine.h</span><a class="headerlink" href="#id2" title="Link to this code"><span>¶</span></a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos"> 1</span><span class="cp">#ifndef MY_GAME_ENGINE_H</span>
</span><span id="line-2"><span class="linenos"> 2</span><span class="cp">#define MY_GAME_ENGINE_H</span>
</span><span id="line-3"><span class="linenos"> 3</span>
</span><span id="line-4"><span class="linenos"> 4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
</span><span id="line-5"><span class="linenos"> 5</span><span class="cm">/**</span>
</span><span id="line-6"><span class="linenos"> 6</span><span class="cm"> * Copyright (C) 2025 Eyeware Tech SA.</span>
</span><span id="line-7"><span class="linenos"> 7</span><span class="cm"> *</span>
</span><span id="line-8"><span class="linenos"> 8</span><span class="cm"> * All rights reserved.</span>
</span><span id="line-9"><span class="linenos"> 9</span><span class="cm"> *</span>
</span><span id="line-10"><span class="linenos">10</span><span class="cm"> * This file defines an extremely simplified game engine using OOP, similar to Unity and UE5</span>
</span><span id="line-11"><span class="linenos">11</span><span class="cm"> * OOP paradigm. In real life we assume all of this is already defined in your engine.</span>
</span><span id="line-12"><span class="linenos">12</span><span class="cm"> *</span>
</span><span id="line-13"><span class="linenos">13</span><span class="cm"> * The good stuff is in files main.cpp and bet_game_engine_device.cpp.</span>
</span><span id="line-14"><span class="linenos">14</span><span class="cm"> */</span>
</span><span id="line-15"><span class="linenos">15</span>
</span><span id="line-16"><span class="linenos">16</span><span class="k">struct</span><span class="w"> </span><span class="nc">MyGameEngineTransform</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-17"><span class="linenos">17</span><span class="w">    </span><span class="c1">// For this sample's purpose, we assume Unity's camera coordinate system which is the same as</span>
</span><span id="line-18"><span class="linenos">18</span><span class="w">    </span><span class="c1">// Beam, except that x is inverted, and the rotations are left-handed, not right-handed.</span>
</span><span id="line-19"><span class="linenos">19</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">rotation_x_degrees</span><span class="p">;</span>
</span><span id="line-20"><span class="linenos">20</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">rotation_y_degrees</span><span class="p">;</span>
</span><span id="line-21"><span class="linenos">21</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">rotation_z_degrees</span><span class="p">;</span>
</span><span id="line-22"><span class="linenos">22</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">translation_x_inches</span><span class="p">;</span>
</span><span id="line-23"><span class="linenos">23</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">translation_y_inches</span><span class="p">;</span>
</span><span id="line-24"><span class="linenos">24</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">translation_z_inches</span><span class="p">;</span>
</span><span id="line-25"><span class="linenos">25</span>
</span><span id="line-26"><span class="linenos">26</span><span class="w">    </span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-27"><span class="linenos">27</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">MyGameEngineTransform</span><span class="p">{</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rotation_x_degrees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">rotation_x_degrees</span><span class="p">,</span>
</span><span id="line-28"><span class="linenos">28</span><span class="w">                                     </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rotation_y_degrees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">rotation_y_degrees</span><span class="p">,</span>
</span><span id="line-29"><span class="linenos">29</span><span class="w">                                     </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">rotation_z_degrees</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">rotation_z_degrees</span><span class="p">,</span>
</span><span id="line-30"><span class="linenos">30</span><span class="w">                                     </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">translation_x_inches</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">translation_x_inches</span><span class="p">,</span>
</span><span id="line-31"><span class="linenos">31</span><span class="w">                                     </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">translation_y_inches</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">translation_y_inches</span><span class="p">,</span>
</span><span id="line-32"><span class="linenos">32</span><span class="w">                                     </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">translation_z_inches</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">translation_z_inches</span><span class="p">};</span>
</span><span id="line-33"><span class="linenos">33</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-34"><span class="linenos">34</span><span class="p">};</span>
</span><span id="line-35"><span class="linenos">35</span>
</span><span id="line-36"><span class="linenos">36</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-37"><span class="linenos">37</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-38"><span class="linenos">38</span><span class="w">    </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parent</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-39"><span class="linenos">39</span><span class="w">    </span><span class="c1">// Called frequently and periodically. delta_time in seconds.</span>
</span><span id="line-40"><span class="linenos">40</span><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="p">{};</span>
</span><span id="line-41"><span class="linenos">41</span>
</span><span id="line-42"><span class="linenos">42</span><span class="w">    </span><span class="c1">// Called when the rendering loop starts.</span>
</span><span id="line-43"><span class="linenos">43</span><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
</span><span id="line-44"><span class="linenos">44</span>
</span><span id="line-45"><span class="linenos">45</span><span class="w">    </span><span class="c1">// Called when the rendering loop stops.</span>
</span><span id="line-46"><span class="linenos">46</span><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">EndPlay</span><span class="p">()</span><span class="w"> </span><span class="p">{};</span>
</span><span id="line-47"><span class="linenos">47</span>
</span><span id="line-48"><span class="linenos">48</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">set_local_transform</span><span class="p">(</span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="n">local_transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-49"><span class="linenos">49</span><span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">local_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">local_transform</span><span class="p">;</span>
</span><span id="line-50"><span class="linenos">50</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-51"><span class="linenos">51</span><span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">world_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">parent</span><span class="o">-&gt;</span><span class="n">world_transform</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">local_transform</span><span class="p">;</span>
</span><span id="line-52"><span class="linenos">52</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-53"><span class="linenos">53</span><span class="w">            </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">world_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">local_transform</span><span class="p">;</span>
</span><span id="line-54"><span class="linenos">54</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-55"><span class="linenos">55</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-56"><span class="linenos">56</span>
</span><span id="line-57"><span class="linenos">57</span><span class="w">    </span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="n">local_transform</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
</span><span id="line-58"><span class="linenos">58</span><span class="w">    </span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="n">world_transform</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
</span><span id="line-59"><span class="linenos">59</span>
</span><span id="line-60"><span class="linenos">60</span><span class="w">    </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">;</span>
</span><span id="line-61"><span class="linenos">61</span><span class="p">};</span>
</span><span id="line-62"><span class="linenos">62</span>
</span><span id="line-63"><span class="linenos">63</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineHUDElement</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-64"><span class="linenos">64</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-65"><span class="linenos">65</span><span class="w">    </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-66"><span class="linenos">66</span><span class="w">        </span><span class="n">TOP_LEFT</span><span class="p">,</span>
</span><span id="line-67"><span class="linenos">67</span><span class="w">        </span><span class="n">TOP_RIGHT</span><span class="p">,</span>
</span><span id="line-68"><span class="linenos">68</span><span class="w">        </span><span class="n">BOTTOM_LEFT</span><span class="p">,</span>
</span><span id="line-69"><span class="linenos">69</span><span class="w">        </span><span class="n">BOTTOM_RIGHT</span><span class="p">,</span>
</span><span id="line-70"><span class="linenos">70</span><span class="w">    </span><span class="p">};</span>
</span><span id="line-71"><span class="linenos">71</span>
</span><span id="line-72"><span class="linenos">72</span><span class="w">    </span><span class="n">MyGameEngineHUDElement</span><span class="p">(</span><span class="n">MyGameEngineHUDElement</span><span class="o">::</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-73"><span class="linenos">73</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">),</span><span class="w"> </span><span class="n">type</span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-74"><span class="linenos">74</span>
</span><span id="line-75"><span class="linenos">75</span><span class="w">    </span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
</span><span id="line-76"><span class="linenos">76</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-77"><span class="linenos">77</span><span class="p">};</span>
</span><span id="line-78"><span class="linenos">78</span>
</span><span id="line-79"><span class="linenos">79</span><span class="cp">#endif </span><span class="c1">// MY_GAME_ENGINE_H</span>
</span></code></pre></div>
</div>
</div>
</section>
<section id="bet-game-engine-device-h">
<h3>bet_game_engine_device.h<a class="headerlink" href="#bet-game-engine-device-h" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#bet-game-engine-device-h'"><span>¶</span></a></h3>
<p>Implements the <code class="docutils literal notranslate"><span class="pre">MyGameEngineBeamEyeTrackerDevice</span></code> which is the key class that you would typically implement
for your specific game engine. You will see that it:</p>
<ul class="simple">
<li><p>manages the <a class="reference internal" href="../basics/general_api_concepts.html#about-api-singleton"><span class="std std-ref">API</span></a> instance;</p></li>
<li><p>uses <a class="reference internal" href="../basics/general_api_concepts.html#about-asynchronous-data-access"><span class="std std-ref">asynchronous data access</span></a> using itself as the <a class="reference internal" href="../api/cpp/index.html#_CPPv4N7eyeware16beam_eye_tracker16TrackingListenerE" title="eyeware::beam_eye_tracker::TrackingListener"><code class="xref cpp cpp-type docutils literal notranslate"><span class="pre">eyeware::beam_eye_tracker::TrackingListener</span></code></a>;</p></li>
<li><p>shows how to <a class="reference internal" href="../basics/general_api_concepts.html#about-auto-start-tracking"><span class="std std-ref">launch the Beam Eye Tracker</span></a> at <code class="docutils literal notranslate"><span class="pre">BeginPlay</span></code>;</p></li>
<li><p>computes HUD opacity values based on <a class="reference internal" href="../features/game_immersive_hud.html#about-game-immersive-hud-ready-to-use-signals"><span class="std std-ref">whether the user is looking at the HUD element or not</span></a>, making
said opacities part of the device output parameters;</p></li>
<li><p>processes the camera pose parameters, <a class="reference internal" href="../features/sim_game_camera.html#sim-mapping"><span class="std std-ref">mapping them to the game engine coordinates</span></a>,
and setting the mapped <code class="docutils literal notranslate"><span class="pre">MyGameEngineTransform</span></code> (yaw, pitch, roll, x, y, z) as a device output parameter;</p></li>
<li><p>processes how game settings affect the device behavior and output.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The sample uses asynchronous data access, but if you can’t guarantee that the <code class="docutils literal notranslate"><span class="pre">TrackerListener</span></code>
will be alive until the handle is explicitly deregistered, you can use <a class="reference internal" href="../basics/general_api_concepts.html#about-polling-data-access"><span class="std std-ref">polling data access</span></a>
instead, which also does not block the main thread.</p>
</div>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">bet_game_engine_device.h</span><a class="headerlink" href="#id3" title="Link to this code"><span>¶</span></a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">  1</span><span class="cm">/**</span>
</span><span id="line-2"><span class="linenos">  2</span><span class="cm"> * Copyright (C) 2025 Eyeware Tech SA.</span>
</span><span id="line-3"><span class="linenos">  3</span><span class="cm"> *</span>
</span><span id="line-4"><span class="linenos">  4</span><span class="cm"> * All rights reserved.</span>
</span><span id="line-5"><span class="linenos">  5</span><span class="cm"> */</span>
</span><span id="line-6"><span class="linenos">  6</span>
</span><span id="line-7"><span class="linenos">  7</span><span class="cp">#ifndef BET_GAME_ENGINE_DEVICE_H</span>
</span><span id="line-8"><span class="linenos">  8</span><span class="cp">#define BET_GAME_ENGINE_DEVICE_H</span>
</span><span id="line-9"><span class="linenos">  9</span>
</span><span id="line-10"><span class="linenos"> 10</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"eyeware/beam_eye_tracker.h"</span>
</span><span id="line-11"><span class="linenos"> 11</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"my_game_engine.h"</span>
</span><span id="line-12"><span class="linenos"> 12</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
</span><span id="line-13"><span class="linenos"> 13</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
</span><span id="line-14"><span class="linenos"> 14</span>
</span><span id="line-15"><span class="linenos"> 15</span><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-16"><span class="linenos"> 16</span>
</span><span id="line-17"><span class="linenos"> 17</span><span class="k">constexpr</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">M_PI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265358979323846</span><span class="p">;</span>
</span><span id="line-18"><span class="linenos"> 18</span><span class="k">constexpr</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">M_RADIANS_TO_DEGREES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">180.0f</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">M_PI</span><span class="p">;</span>
</span><span id="line-19"><span class="linenos"> 19</span><span class="k">constexpr</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">M_METERS_TO_INCHES</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">39.3700787</span><span class="p">;</span>
</span><span id="line-20"><span class="linenos"> 20</span>
</span><span id="line-21"><span class="linenos"> 21</span><span class="kt">float</span><span class="w"> </span><span class="nf">update_hud_opacity</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">prev_opacity</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">looking_at_hud</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-22"><span class="linenos"> 22</span><span class="w">    </span><span class="c1">// Implements asymmetric linear opacity update. You can use a nicer animation curve.</span>
</span><span id="line-23"><span class="linenos"> 23</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">opacity_rate_on_looking_at_hud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">10.0f</span><span class="p">;</span><span class="w">     </span><span class="c1">// Fully visible in max 0.1 seconds</span>
</span><span id="line-24"><span class="linenos"> 24</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">opacity_rate_on_not_looking_at_hud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">;</span><span class="w"> </span><span class="c1">// Fully invisible in max 1 seconds</span>
</span><span id="line-25"><span class="linenos"> 25</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">min_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2f</span><span class="p">;</span><span class="w"> </span><span class="c1">// In case the HUD should not fully disappear</span>
</span><span id="line-26"><span class="linenos"> 26</span>
</span><span id="line-27"><span class="linenos"> 27</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">opacity_update_rate</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-28"><span class="linenos"> 28</span><span class="w">        </span><span class="n">looking_at_hud</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">opacity_rate_on_looking_at_hud</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">opacity_rate_on_not_looking_at_hud</span><span class="p">;</span>
</span><span id="line-29"><span class="linenos"> 29</span><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">prev_opacity</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">opacity_update_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_time</span><span class="p">,</span><span class="w"> </span><span class="n">min_opacity</span><span class="p">),</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">);</span>
</span><span id="line-30"><span class="linenos"> 30</span><span class="p">}</span>
</span><span id="line-31"><span class="linenos"> 31</span>
</span><span id="line-32"><span class="linenos"> 32</span><span class="p">}</span><span class="w"> </span><span class="c1">// namespace</span>
</span><span id="line-33"><span class="linenos"> 33</span>
</span><span id="line-34"><span class="linenos"> 34</span><span class="c1">// Note, for this sample, we keep explicit mentions to the namespace eyeware::beam_eye_tracker</span>
</span><span id="line-35"><span class="linenos"> 35</span><span class="c1">// to make it easier to separate API related code.</span>
</span><span id="line-36"><span class="linenos"> 36</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TrackingListener</span><span class="p">,</span>
</span><span id="line-37"><span class="linenos"> 37</span><span class="w">                                         </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-38"><span class="linenos"> 38</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-39"><span class="linenos"> 39</span><span class="w">    </span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-40"><span class="linenos"> 40</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-41"><span class="linenos"> 41</span><span class="w">        </span><span class="c1">// We only need one instance of the API. You can also create it on "Begin Play" if you</span>
</span><span id="line-42"><span class="linenos"> 42</span><span class="w">        </span><span class="c1">// want to, but here it is created in the constructor for simplicity and not to check</span>
</span><span id="line-43"><span class="linenos"> 43</span><span class="w">        </span><span class="c1">// on pointer validity.</span>
</span><span id="line-44"><span class="linenos"> 44</span><span class="w">        </span><span class="n">m_bet_api</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">API</span><span class="o">&gt;</span><span class="p">(</span>
</span><span id="line-45"><span class="linenos"> 45</span><span class="w">            </span><span class="s">"Game Engine Integration Sample"</span><span class="p">,</span><span class="w"> </span><span class="n">get_rendering_area_viewport_geometry_from_engine</span><span class="p">());</span>
</span><span id="line-46"><span class="linenos"> 46</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-47"><span class="linenos"> 47</span>
</span><span id="line-48"><span class="linenos"> 48</span><span class="w">    </span><span class="o">~</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">stop_bet_api_tracking_data_reception</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="line-49"><span class="linenos"> 49</span>
</span><span id="line-50"><span class="linenos"> 50</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-51"><span class="linenos"> 51</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_auto_start_tracking</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-52"><span class="linenos"> 52</span><span class="w">            </span><span class="c1">// If auto start is toggled on, this will request the Beam app to launch and</span>
</span><span id="line-53"><span class="linenos"> 53</span><span class="w">            </span><span class="c1">// or to start the webcam and initialize the tracking.</span>
</span><span id="line-54"><span class="linenos"> 54</span><span class="w">            </span><span class="c1">// HEADS UP! Be wise when you call this. Ideally you want to call it when the game</span>
</span><span id="line-55"><span class="linenos"> 55</span><span class="w">            </span><span class="c1">// rendering starts and accepts device input, as otherwise may start the webcam</span>
</span><span id="line-56"><span class="linenos"> 56</span><span class="w">            </span><span class="c1">// at a random time and confuse the user.</span>
</span><span id="line-57"><span class="linenos"> 57</span><span class="w">            </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">attempt_starting_the_beam_eye_tracker</span><span class="p">();</span>
</span><span id="line-58"><span class="linenos"> 58</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-59"><span class="linenos"> 59</span>
</span><span id="line-60"><span class="linenos"> 60</span><span class="w">        </span><span class="c1">// Register itself as the listener to receive tracking data from the Beam Eye Tracker</span>
</span><span id="line-61"><span class="linenos"> 61</span><span class="w">        </span><span class="c1">// application on the on_tracking_state_set_update method asynchronously.</span>
</span><span id="line-62"><span class="linenos"> 62</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_listener_handle</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">INVALID_TRACKING_LISTENER_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-63"><span class="linenos"> 63</span><span class="w">            </span><span class="n">m_listener_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">start_receiving_tracking_data_on_listener</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span><span id="line-64"><span class="linenos"> 64</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-65"><span class="linenos"> 65</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-66"><span class="linenos"> 66</span>
</span><span id="line-67"><span class="linenos"> 67</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">EndPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">stop_bet_api_tracking_data_reception</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="line-68"><span class="linenos"> 68</span>
</span><span id="line-69"><span class="linenos"> 69</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-70"><span class="linenos"> 70</span><span class="w">        </span><span class="c1">// For the purpose of this sample, we assume a custom device output is the HUD opacity,</span>
</span><span id="line-71"><span class="linenos"> 71</span><span class="w">        </span><span class="c1">// which is updated here.</span>
</span><span id="line-72"><span class="linenos"> 72</span>
</span><span id="line-73"><span class="linenos"> 73</span><span class="w">        </span><span class="c1">// Animate the opacity change depending on whether the user is looking at HUD elements.</span>
</span><span id="line-74"><span class="linenos"> 74</span><span class="w">        </span><span class="n">device_output_top_left_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_hud_opacity</span><span class="p">(</span>
</span><span id="line-75"><span class="linenos"> 75</span><span class="w">            </span><span class="n">device_output_top_left_hud_opacity</span><span class="p">,</span><span class="w"> </span><span class="n">m_is_user_looking_at_top_left_corner</span><span class="p">,</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-76"><span class="linenos"> 76</span><span class="w">        </span><span class="n">device_output_top_right_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">update_hud_opacity</span><span class="p">(</span>
</span><span id="line-77"><span class="linenos"> 77</span><span class="w">            </span><span class="n">device_output_top_right_hud_opacity</span><span class="p">,</span><span class="w"> </span><span class="n">m_is_user_looking_at_top_right_corner</span><span class="p">,</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-78"><span class="linenos"> 78</span><span class="w">        </span><span class="n">device_output_bottom_left_hud_opacity</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-79"><span class="linenos"> 79</span><span class="w">            </span><span class="n">update_hud_opacity</span><span class="p">(</span><span class="n">device_output_bottom_left_hud_opacity</span><span class="p">,</span>
</span><span id="line-80"><span class="linenos"> 80</span><span class="w">                               </span><span class="n">m_is_user_looking_at_bottom_left_corner</span><span class="p">,</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-81"><span class="linenos"> 81</span><span class="w">        </span><span class="n">device_output_bottom_right_hud_opacity</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-82"><span class="linenos"> 82</span><span class="w">            </span><span class="n">update_hud_opacity</span><span class="p">(</span><span class="n">device_output_bottom_right_hud_opacity</span><span class="p">,</span>
</span><span id="line-83"><span class="linenos"> 83</span><span class="w">                               </span><span class="n">m_is_user_looking_at_bottom_right_corner</span><span class="p">,</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-84"><span class="linenos"> 84</span>
</span><span id="line-85"><span class="linenos"> 85</span><span class="w">        </span><span class="c1">// Update viewport every 3 seconds in case the rendering area geometry changed.</span>
</span><span id="line-86"><span class="linenos"> 86</span><span class="w">        </span><span class="c1">// In the Beam Eye Tracker application API, this operation is light-weight</span>
</span><span id="line-87"><span class="linenos"> 87</span><span class="w">        </span><span class="c1">// so you could call it more frequently, but 3 seconds balances the trade-off between</span>
</span><span id="line-88"><span class="linenos"> 88</span><span class="w">        </span><span class="c1">// slight-overhead (inc. game engine retrieval of the geometry) and responsiveness in case</span>
</span><span id="line-89"><span class="linenos"> 89</span><span class="w">        </span><span class="c1">// the game was resized or moved. If you have an specific event for game window geometry</span>
</span><span id="line-90"><span class="linenos"> 90</span><span class="w">        </span><span class="c1">// changes, may be better suited for this purpose.</span>
</span><span id="line-91"><span class="linenos"> 91</span><span class="w">        </span><span class="n">m_time_since_last_viewport_geometry_update</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">delta_time</span><span class="p">;</span>
</span><span id="line-92"><span class="linenos"> 92</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_time_since_last_viewport_geometry_update</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-93"><span class="linenos"> 93</span><span class="w">            </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">update_viewport_geometry</span><span class="p">(</span><span class="n">get_rendering_area_viewport_geometry_from_engine</span><span class="p">());</span>
</span><span id="line-94"><span class="linenos"> 94</span><span class="w">            </span><span class="n">m_time_since_last_viewport_geometry_update</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
</span><span id="line-95"><span class="linenos"> 95</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-96"><span class="linenos"> 96</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-97"><span class="linenos"> 97</span>
</span><span id="line-98"><span class="linenos"> 98</span><span class="w">    </span><span class="c1">// Functions for recentering the camera. Likely mapped to a hotkey press/release event.</span>
</span><span id="line-99"><span class="linenos"> 99</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">recenter_camera_start</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">recenter_sim_game_camera_start</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="line-100"><span class="linenos">100</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">recenter_camera_end</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">recenter_sim_game_camera_end</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
</span><span id="line-101"><span class="linenos">101</span>
</span><span id="line-102"><span class="linenos">102</span><span class="w">    </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">ViewportGeometry</span><span class="w"> </span><span class="n">get_rendering_area_viewport_geometry_from_engine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-103"><span class="linenos">103</span><span class="w">        </span><span class="c1">// Implement here your Game Engine specific logic where you retrieve the rendering area</span>
</span><span id="line-104"><span class="linenos">104</span><span class="w">        </span><span class="c1">// geometry, i.e., the viewport. We need to keep the eyeware::beam_eye_tracker::API up to</span>
</span><span id="line-105"><span class="linenos">105</span><span class="w">        </span><span class="c1">// date with changes in the viewport geometry.</span>
</span><span id="line-106"><span class="linenos">106</span>
</span><span id="line-107"><span class="linenos">107</span><span class="w">        </span><span class="c1">// For this demo, assume this configuration: three physical monitors from left to right of</span>
</span><span id="line-108"><span class="linenos">108</span><span class="w">        </span><span class="c1">// resolutions 1920x1080, 1920x1080, 1920x1080. The left-most monitor is configured in</span>
</span><span id="line-109"><span class="linenos">109</span><span class="w">        </span><span class="c1">// Windows settings as the "Main display" (thus, it defines the (0, 0) coordinates in the</span>
</span><span id="line-110"><span class="linenos">110</span><span class="w">        </span><span class="c1">// Windows Virtual Screen), and the game is rendering full screen in the center monitor.</span>
</span><span id="line-111"><span class="linenos">111</span><span class="w">        </span><span class="c1">// Moreover, lets assume this game engine follows Unity's viewport standard, where the the</span>
</span><span id="line-112"><span class="linenos">112</span><span class="w">        </span><span class="c1">// viewport (0, 0) coordinates are at the bottom-left corner of the rendering area.</span>
</span><span id="line-113"><span class="linenos">113</span><span class="w">        </span><span class="c1">// Thus this coordinates would represent that configuration:</span>
</span><span id="line-114"><span class="linenos">114</span><span class="w">        </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">Point</span><span class="w"> </span><span class="n">point_00</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1920</span><span class="p">,</span><span class="w"> </span><span class="mi">1079</span><span class="p">};</span>
</span><span id="line-115"><span class="linenos">115</span><span class="w">        </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">Point</span><span class="w"> </span><span class="n">point_11</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mi">1920</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1920</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">};</span>
</span><span id="line-116"><span class="linenos">116</span>
</span><span id="line-117"><span class="linenos">117</span><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">point_00</span><span class="p">,</span><span class="w"> </span><span class="n">point_11</span><span class="p">};</span>
</span><span id="line-118"><span class="linenos">118</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-119"><span class="linenos">119</span>
</span><span id="line-120"><span class="linenos">120</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">on_tracking_data_reception_status_changed</span><span class="p">(</span>
</span><span id="line-121"><span class="linenos">121</span><span class="w">        </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TrackingDataReceptionStatus</span><span class="w"> </span><span class="n">status</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-122"><span class="linenos">122</span>
</span><span id="line-123"><span class="linenos">123</span><span class="w">        </span><span class="c1">// See TrackingDataReceptionStatus for explanation on all possible statuses.</span>
</span><span id="line-124"><span class="linenos">124</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">status</span><span class="w"> </span><span class="o">==</span>
</span><span id="line-125"><span class="linenos">125</span><span class="w">            </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TrackingDataReceptionStatus</span><span class="o">::</span><span class="n">NOT_RECEIVING_TRACKING_DATA</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-126"><span class="linenos">126</span><span class="w">            </span><span class="c1">// If the tracking data reception status is NOT_RECEIVING_TRACKING_DATA is because the</span>
</span><span id="line-127"><span class="linenos">127</span><span class="w">            </span><span class="c1">// Beam app is not open, the webcam is not active, the client was rejected from using</span>
</span><span id="line-128"><span class="linenos">128</span><span class="w">            </span><span class="c1">// the API, the user is not signed in, etc. etc.. To "fix" this, manual intervention</span>
</span><span id="line-129"><span class="linenos">129</span><span class="w">            </span><span class="c1">// from the user is required. Note that this state could be reached shortly after a call</span>
</span><span id="line-130"><span class="linenos">130</span><span class="w">            </span><span class="c1">// to attempt_starting_the_beam_eye_tracker, which failed to achieve the auto-start.</span>
</span><span id="line-131"><span class="linenos">131</span><span class="w">            </span><span class="c1">// You can try calling attempt_starting_the_beam_eye_tracker again, but it is a question</span>
</span><span id="line-132"><span class="linenos">132</span><span class="w">            </span><span class="c1">// of user experience, as the user may be manually toggling off, but the game insists on</span>
</span><span id="line-133"><span class="linenos">133</span><span class="w">            </span><span class="c1">// toggling on.</span>
</span><span id="line-134"><span class="linenos">134</span>
</span><span id="line-135"><span class="linenos">135</span><span class="w">            </span><span class="c1">// In this situation, makes sense to reset the device output to default values.</span>
</span><span id="line-136"><span class="linenos">136</span><span class="w">            </span><span class="c1">// Animation curves could be used for a smoother transition.</span>
</span><span id="line-137"><span class="linenos">137</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
</span><span id="line-138"><span class="linenos">138</span>
</span><span id="line-139"><span class="linenos">139</span><span class="w">            </span><span class="n">device_output_top_left_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-140"><span class="linenos">140</span><span class="w">            </span><span class="n">device_output_top_right_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-141"><span class="linenos">141</span><span class="w">            </span><span class="n">device_output_bottom_left_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-142"><span class="linenos">142</span><span class="w">            </span><span class="n">device_output_bottom_right_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-143"><span class="linenos">143</span>
</span><span id="line-144"><span class="linenos">144</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-145"><span class="linenos">145</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-146"><span class="linenos">146</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-147"><span class="linenos">147</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-148"><span class="linenos">148</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-149"><span class="linenos">149</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-150"><span class="linenos">150</span>
</span><span id="line-151"><span class="linenos">151</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">on_tracking_state_set_update</span><span class="p">(</span>
</span><span id="line-152"><span class="linenos">152</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TrackingStateSet</span><span class="w"> </span><span class="o">&amp;</span><span class="n">tracking_state_set</span><span class="p">,</span>
</span><span id="line-153"><span class="linenos">153</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">Timestamp</span><span class="w"> </span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-154"><span class="linenos">154</span><span class="w">        </span><span class="c1">// Async callback to retrieve the tracking data.</span>
</span><span id="line-155"><span class="linenos">155</span>
</span><span id="line-156"><span class="linenos">156</span><span class="w">        </span><span class="n">update_device_viewport_gaze_state_from_bet_api_input</span><span class="p">(</span><span class="n">tracking_state_set</span><span class="p">.</span><span class="n">user_state</span><span class="p">());</span>
</span><span id="line-157"><span class="linenos">157</span>
</span><span id="line-158"><span class="linenos">158</span><span class="w">        </span><span class="n">update_device_sim_game_camera_state_from_bet_api_input</span><span class="p">(</span>
</span><span id="line-159"><span class="linenos">159</span><span class="w">            </span><span class="n">tracking_state_set</span><span class="p">.</span><span class="n">sim_game_camera_state</span><span class="p">());</span>
</span><span id="line-160"><span class="linenos">160</span>
</span><span id="line-161"><span class="linenos">161</span><span class="w">        </span><span class="n">update_device_game_immersive_hud_state_from_bet_api_input</span><span class="p">(</span>
</span><span id="line-162"><span class="linenos">162</span><span class="w">            </span><span class="n">tracking_state_set</span><span class="p">.</span><span class="n">game_immersive_hud_state</span><span class="p">());</span>
</span><span id="line-163"><span class="linenos">163</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-164"><span class="linenos">164</span>
</span><span id="line-165"><span class="linenos">165</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update_device_viewport_gaze_state_from_bet_api_input</span><span class="p">(</span>
</span><span id="line-166"><span class="linenos">166</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">UserState</span><span class="w"> </span><span class="o">&amp;</span><span class="n">user_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-167"><span class="linenos">167</span>
</span><span id="line-168"><span class="linenos">168</span><span class="w">        </span><span class="c1">// Eye tracking coordinates referred to the viewport area.</span>
</span><span id="line-169"><span class="linenos">169</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">user_state</span><span class="p">.</span><span class="n">timestamp_in_seconds</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">NULL_DATA_TIMESTAMP</span><span class="w"> </span><span class="o">&amp;&amp;</span>
</span><span id="line-170"><span class="linenos">170</span><span class="w">            </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">cast_confidence</span><span class="p">(</span><span class="n">user_state</span><span class="p">.</span><span class="n">viewport_gaze</span><span class="p">.</span><span class="n">confidence</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span>
</span><span id="line-171"><span class="linenos">171</span><span class="w">                </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TrackingConfidence</span><span class="o">::</span><span class="n">LOST_TRACKING</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-172"><span class="linenos">172</span>
</span><span id="line-173"><span class="linenos">173</span><span class="w">            </span><span class="c1">// Normalized gaze coordinates in the viewport. Normalized as it is in the range [0, 1],</span>
</span><span id="line-174"><span class="linenos">174</span><span class="w">            </span><span class="c1">// however, values outside this range are possible.</span>
</span><span id="line-175"><span class="linenos">175</span><span class="w">            </span><span class="n">device_output_viewport_normalized_gaze_x</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-176"><span class="linenos">176</span><span class="w">                </span><span class="n">user_state</span><span class="p">.</span><span class="n">viewport_gaze</span><span class="p">.</span><span class="n">normalized_point_of_regard</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
</span><span id="line-177"><span class="linenos">177</span><span class="w">            </span><span class="n">device_output_viewport_normalized_gaze_y</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-178"><span class="linenos">178</span><span class="w">                </span><span class="n">user_state</span><span class="p">.</span><span class="n">viewport_gaze</span><span class="p">.</span><span class="n">normalized_point_of_regard</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
</span><span id="line-179"><span class="linenos">179</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-180"><span class="linenos">180</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-181"><span class="linenos">181</span>
</span><span id="line-182"><span class="linenos">182</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update_device_sim_game_camera_state_from_bet_api_input</span><span class="p">(</span>
</span><span id="line-183"><span class="linenos">183</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">SimGameCameraState</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sim_game_camera_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-184"><span class="linenos">184</span>
</span><span id="line-185"><span class="linenos">185</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">sim_game_camera_state</span><span class="p">.</span><span class="n">timestamp_in_seconds</span><span class="w"> </span><span class="o">!=</span>
</span><span id="line-186"><span class="linenos">186</span><span class="w">            </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">NULL_DATA_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-187"><span class="linenos">187</span>
</span><span id="line-188"><span class="linenos">188</span><span class="w">            </span><span class="c1">// Mapping sensitivity (default 0.5) to weight (default 1.0). Note this mapping</span>
</span><span id="line-189"><span class="linenos">189</span><span class="w">            </span><span class="c1">// could be more complex, but the assumption is that a weight of 1.0 would make the</span>
</span><span id="line-190"><span class="linenos">190</span><span class="w">            </span><span class="c1">// signal as configured by the user within the Beam Eye Tracker application.</span>
</span><span id="line-191"><span class="linenos">191</span><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">sim_game_camera_eye_tracking_weight</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-192"><span class="linenos">192</span><span class="w">                </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_sim_game_camera_eye_tracking_sensitivity</span><span class="p">;</span>
</span><span id="line-193"><span class="linenos">193</span><span class="w">            </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">sim_game_camera_head_tracking_weight</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-194"><span class="linenos">194</span><span class="w">                </span><span class="mf">2.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">m_sim_game_camera_head_tracking_sensitivity</span><span class="p">;</span>
</span><span id="line-195"><span class="linenos">195</span>
</span><span id="line-196"><span class="linenos">196</span><span class="w">            </span><span class="c1">// This combines the signals into one transform.</span>
</span><span id="line-197"><span class="linenos">197</span><span class="w">            </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">SimCameraTransform3D</span><span class="w"> </span><span class="n">bet_camera_local_transform</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-198"><span class="linenos">198</span><span class="w">                </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">API</span><span class="o">::</span><span class="n">compute_sim_game_camera_transform_parameters</span><span class="p">(</span>
</span><span id="line-199"><span class="linenos">199</span><span class="w">                    </span><span class="n">sim_game_camera_state</span><span class="p">,</span><span class="w"> </span><span class="n">sim_game_camera_eye_tracking_weight</span><span class="p">,</span>
</span><span id="line-200"><span class="linenos">200</span><span class="w">                    </span><span class="n">sim_game_camera_head_tracking_weight</span><span class="p">);</span>
</span><span id="line-201"><span class="linenos">201</span>
</span><span id="line-202"><span class="linenos">202</span><span class="w">            </span><span class="c1">// Now, we need to map the beam eye tracker coordinates to the game engine</span>
</span><span id="line-203"><span class="linenos">203</span><span class="w">            </span><span class="c1">// coordinates. See the documentation of the API for SimCameraTransform3D explaining</span>
</span><span id="line-204"><span class="linenos">204</span><span class="w">            </span><span class="c1">// the API in detail. Assuming the game engine is using Unity's coordinate system,</span>
</span><span id="line-205"><span class="linenos">205</span><span class="w">            </span><span class="c1">// which is the same as Beam, except that x is inverted, and the rotations are</span>
</span><span id="line-206"><span class="linenos">206</span><span class="w">            </span><span class="c1">// left-handed, not right-handed. The rotation order for roll, pitch, yaw is</span>
</span><span id="line-207"><span class="linenos">207</span><span class="w">            </span><span class="c1">// consistent with Beam's.</span>
</span><span id="line-208"><span class="linenos">208</span>
</span><span id="line-209"><span class="linenos">209</span><span class="w">            </span><span class="c1">// Rotations going from right-handed to left-handed coordinate system.</span>
</span><span id="line-210"><span class="linenos">210</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">rotation_x_degrees</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-211"><span class="linenos">211</span><span class="w">                </span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">pitch_in_radians</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_RADIANS_TO_DEGREES</span><span class="p">;</span>
</span><span id="line-212"><span class="linenos">212</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">rotation_y_degrees</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-213"><span class="linenos">213</span><span class="w">                </span><span class="o">-</span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">yaw_in_radians</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_RADIANS_TO_DEGREES</span><span class="p">;</span>
</span><span id="line-214"><span class="linenos">214</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">rotation_z_degrees</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-215"><span class="linenos">215</span><span class="w">                </span><span class="o">-</span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">roll_in_radians</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_RADIANS_TO_DEGREES</span><span class="p">;</span>
</span><span id="line-216"><span class="linenos">216</span>
</span><span id="line-217"><span class="linenos">217</span><span class="w">            </span><span class="c1">// Translations going from right-handed to left-handed coordinate system.</span>
</span><span id="line-218"><span class="linenos">218</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">translation_x_inches</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-219"><span class="linenos">219</span><span class="w">                </span><span class="o">-</span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">x_in_meters</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_METERS_TO_INCHES</span><span class="p">;</span>
</span><span id="line-220"><span class="linenos">220</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">translation_y_inches</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-221"><span class="linenos">221</span><span class="w">                </span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">y_in_meters</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_METERS_TO_INCHES</span><span class="p">;</span>
</span><span id="line-222"><span class="linenos">222</span><span class="w">            </span><span class="n">device_output_camera_local_transform</span><span class="p">.</span><span class="n">translation_z_inches</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-223"><span class="linenos">223</span><span class="w">                </span><span class="n">bet_camera_local_transform</span><span class="p">.</span><span class="n">z_in_meters</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_METERS_TO_INCHES</span><span class="p">;</span>
</span><span id="line-224"><span class="linenos">224</span>
</span><span id="line-225"><span class="linenos">225</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-226"><span class="linenos">226</span><span class="w">            </span><span class="c1">// There could be multiple reasons to receive a NULL_DATA_TIMESTAMP in the callback.</span>
</span><span id="line-227"><span class="linenos">227</span><span class="w">            </span><span class="c1">// But in general it means an interruption of the normal tracking, the feature</span>
</span><span id="line-228"><span class="linenos">228</span><span class="w">            </span><span class="c1">// itself, or other.</span>
</span><span id="line-229"><span class="linenos">229</span>
</span><span id="line-230"><span class="linenos">230</span><span class="w">            </span><span class="c1">// For user experience, the camera should NOT be reset to the default position</span>
</span><span id="line-231"><span class="linenos">231</span><span class="w">            </span><span class="c1">// immediately (m_latest_sim_game_camera_transform being 0.0f), as that would be</span>
</span><span id="line-232"><span class="linenos">232</span><span class="w">            </span><span class="c1">// confusing: imagine the user going briefly off-frame to connect a cable, but</span>
</span><span id="line-233"><span class="linenos">233</span><span class="w">            </span><span class="c1">// suddenly the camera snaps to zero. Instead, we suggest to keep the</span>
</span><span id="line-234"><span class="linenos">234</span><span class="w">            </span><span class="c1">// m_latest_sim_game_camera_transform as is with the latest valid data.</span>
</span><span id="line-235"><span class="linenos">235</span><span class="w">            </span><span class="c1">//</span>
</span><span id="line-236"><span class="linenos">236</span><span class="w">            </span><span class="c1">// However, you may also choose to set it to zeros after a reasonable time, and</span>
</span><span id="line-237"><span class="linenos">237</span><span class="w">            </span><span class="c1">// perhaps even slowly. But that's your choice.</span>
</span><span id="line-238"><span class="linenos">238</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-239"><span class="linenos">239</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-240"><span class="linenos">240</span>
</span><span id="line-241"><span class="linenos">241</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">update_device_game_immersive_hud_state_from_bet_api_input</span><span class="p">(</span>
</span><span id="line-242"><span class="linenos">242</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">GameImmersiveHUDState</span><span class="w"> </span><span class="o">&amp;</span><span class="n">game_immersive_hud_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-243"><span class="linenos">243</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">game_immersive_hud_state</span><span class="p">.</span><span class="n">timestamp_in_seconds</span><span class="w"> </span><span class="o">!=</span>
</span><span id="line-244"><span class="linenos">244</span><span class="w">            </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">NULL_DATA_TIMESTAMP</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-245"><span class="linenos">245</span>
</span><span id="line-246"><span class="linenos">246</span><span class="w">            </span><span class="c1">// Note: the input values are interpreted a "likelihood" or as a "probability", so</span>
</span><span id="line-247"><span class="linenos">247</span><span class="w">            </span><span class="c1">// you can simply threshold it.</span>
</span><span id="line-248"><span class="linenos">248</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_left_corner</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-249"><span class="linenos">249</span><span class="w">                </span><span class="n">game_immersive_hud_state</span><span class="p">.</span><span class="n">looking_at_viewport_top_left</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-250"><span class="linenos">250</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_right_corner</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-251"><span class="linenos">251</span><span class="w">                </span><span class="n">game_immersive_hud_state</span><span class="p">.</span><span class="n">looking_at_viewport_top_right</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-252"><span class="linenos">252</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_left_corner</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-253"><span class="linenos">253</span><span class="w">                </span><span class="n">game_immersive_hud_state</span><span class="p">.</span><span class="n">looking_at_viewport_bottom_left</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-254"><span class="linenos">254</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_right_corner</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-255"><span class="linenos">255</span><span class="w">                </span><span class="n">game_immersive_hud_state</span><span class="p">.</span><span class="n">looking_at_viewport_bottom_right</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-256"><span class="linenos">256</span>
</span><span id="line-257"><span class="linenos">257</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-258"><span class="linenos">258</span><span class="w">            </span><span class="c1">// There could be multiple reasons to receive a NULL_DATA_TIMESTAMP in the callback.</span>
</span><span id="line-259"><span class="linenos">259</span><span class="w">            </span><span class="c1">// But in general it means an interruption of the normal tracking, the feature</span>
</span><span id="line-260"><span class="linenos">260</span><span class="w">            </span><span class="c1">// itself, or other.</span>
</span><span id="line-261"><span class="linenos">261</span>
</span><span id="line-262"><span class="linenos">262</span><span class="w">            </span><span class="c1">// In this case, it makes sense to "reset" at set all the HUD as visible. For</span>
</span><span id="line-263"><span class="linenos">263</span><span class="w">            </span><span class="c1">// example, assume the user is off-camera.</span>
</span><span id="line-264"><span class="linenos">264</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-265"><span class="linenos">265</span><span class="w">            </span><span class="n">m_is_user_looking_at_top_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-266"><span class="linenos">266</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-267"><span class="linenos">267</span><span class="w">            </span><span class="n">m_is_user_looking_at_bottom_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-268"><span class="linenos">268</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-269"><span class="linenos">269</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-270"><span class="linenos">270</span>
</span><span id="line-271"><span class="linenos">271</span><span class="w">    </span><span class="c1">//*********  VARIABLES ASSUMED TO BE LINKED TO IN-GAME SETTINGS ****************** */</span>
</span><span id="line-272"><span class="linenos">272</span><span class="w">    </span><span class="c1">// Note: we don't define the setters to avoid clutter.</span>
</span><span id="line-273"><span class="linenos">273</span><span class="w">    </span><span class="cm">/**</span>
</span><span id="line-274"><span class="linenos">274</span><span class="cm">     * @brief Implement a user interface that allows to change this value.</span>
</span><span id="line-275"><span class="linenos">275</span><span class="cm">     */</span>
</span><span id="line-276"><span class="linenos">276</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_auto_start_tracking</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-277"><span class="linenos">277</span>
</span><span id="line-278"><span class="linenos">278</span><span class="w">    </span><span class="c1">// For the in-game camera controls, assumed to be in the range [0, 1].</span>
</span><span id="line-279"><span class="linenos">279</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">m_sim_game_camera_eye_tracking_sensitivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-280"><span class="linenos">280</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">m_sim_game_camera_head_tracking_sensitivity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">;</span>
</span><span id="line-281"><span class="linenos">281</span>
</span><span id="line-282"><span class="linenos">282</span><span class="w">    </span><span class="c1">//************ VARIABLES REPRESENTING THE DEVICE STATE/OUTPUT ************ */</span>
</span><span id="line-283"><span class="linenos">283</span><span class="w">    </span><span class="c1">// Note: we don't define the getters to avoid clutter.</span>
</span><span id="line-284"><span class="linenos">284</span>
</span><span id="line-285"><span class="linenos">285</span><span class="w">    </span><span class="c1">// Sim game camera local/additive transform</span>
</span><span id="line-286"><span class="linenos">286</span><span class="w">    </span><span class="n">MyGameEngineTransform</span><span class="w"> </span><span class="n">device_output_camera_local_transform</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">};</span>
</span><span id="line-287"><span class="linenos">287</span>
</span><span id="line-288"><span class="linenos">288</span><span class="w">    </span><span class="c1">// Immersive HUD state. Here it is default opaque,  i.e., all the HUD is visible until</span>
</span><span id="line-289"><span class="linenos">289</span><span class="w">    </span><span class="c1">// tracking data says otherwise. It's different than the boolean counterparts, as the</span>
</span><span id="line-290"><span class="linenos">290</span><span class="w">    </span><span class="c1">// opacity changes are smooth across frames.</span>
</span><span id="line-291"><span class="linenos">291</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_top_left_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-292"><span class="linenos">292</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_top_right_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-293"><span class="linenos">293</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_bottom_left_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-294"><span class="linenos">294</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_bottom_right_hud_opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">;</span>
</span><span id="line-295"><span class="linenos">295</span>
</span><span id="line-296"><span class="linenos">296</span><span class="w">    </span><span class="c1">// Normalized gaze coordinates in the viewport.</span>
</span><span id="line-297"><span class="linenos">297</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_viewport_normalized_gaze_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
</span><span id="line-298"><span class="linenos">298</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">device_output_viewport_normalized_gaze_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">;</span>
</span><span id="line-299"><span class="linenos">299</span>
</span><span id="line-300"><span class="linenos">300</span><span class="w">    </span><span class="c1">//************************************************************************************ */</span>
</span><span id="line-301"><span class="linenos">301</span>
</span><span id="line-302"><span class="linenos">302</span><span class="w">  </span><span class="k">private</span><span class="o">:</span>
</span><span id="line-303"><span class="linenos">303</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_is_user_looking_at_top_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-304"><span class="linenos">304</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_is_user_looking_at_top_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-305"><span class="linenos">305</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_is_user_looking_at_bottom_left_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-306"><span class="linenos">306</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">m_is_user_looking_at_bottom_right_corner</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="line-307"><span class="linenos">307</span>
</span><span id="line-308"><span class="linenos">308</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">stop_bet_api_tracking_data_reception</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-309"><span class="linenos">309</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">m_listener_handle</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">INVALID_TRACKING_LISTENER_HANDLE</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-310"><span class="linenos">310</span><span class="w">            </span><span class="n">m_bet_api</span><span class="o">-&gt;</span><span class="n">stop_receiving_tracking_data_on_listener</span><span class="p">(</span><span class="n">m_listener_handle</span><span class="p">);</span>
</span><span id="line-311"><span class="linenos">311</span><span class="w">            </span><span class="n">m_listener_handle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">INVALID_TRACKING_LISTENER_HANDLE</span><span class="p">;</span>
</span><span id="line-312"><span class="linenos">312</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-313"><span class="linenos">313</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-314"><span class="linenos">314</span>
</span><span id="line-315"><span class="linenos">315</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">API</span><span class="o">&gt;</span><span class="w"> </span><span class="n">m_bet_api</span><span class="p">;</span>
</span><span id="line-316"><span class="linenos">316</span><span class="w">    </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">TRACKING_LISTENER_HANDLE</span><span class="w"> </span><span class="n">m_listener_handle</span><span class="p">{</span>
</span><span id="line-317"><span class="linenos">317</span><span class="w">        </span><span class="n">eyeware</span><span class="o">::</span><span class="n">beam_eye_tracker</span><span class="o">::</span><span class="n">INVALID_TRACKING_LISTENER_HANDLE</span><span class="p">};</span>
</span><span id="line-318"><span class="linenos">318</span><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">m_time_since_last_viewport_geometry_update</span><span class="p">{</span><span class="mf">0.0f</span><span class="p">};</span>
</span><span id="line-319"><span class="linenos">319</span><span class="p">};</span>
</span><span id="line-320"><span class="linenos">320</span>
</span><span id="line-321"><span class="linenos">321</span><span class="cp">#endif </span><span class="c1">// BET_GAME_ENGINE_DEVICE_H</span>
</span></code></pre></div>
</div>
</div>
</section>
<section id="main-cpp">
<h3>main.cpp<a class="headerlink" href="#main-cpp" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#main-cpp'"><span>¶</span></a></h3>
<p>This is the main function that manages the scene objects, the <code class="docutils literal notranslate"><span class="pre">MyGameEngineBeamEyeTrackerDevice</span></code> instance, and the game loop,
in particular, it:</p>
<ul class="simple">
<li><p>Creates a HUD <code class="docutils literal notranslate"><span class="pre">MyGameEngineImmersiveHUD</span></code> consisting of a <code class="docutils literal notranslate"><span class="pre">MyGameEngineHUDElement</span></code> instance on each of the 4 corners of the viewport;</p></li>
<li><p>Creates a scene in which a camera <code class="docutils literal notranslate"><span class="pre">MyGameEngineImmersiveCamera</span></code> is positioned as a child of a character head <code class="docutils literal notranslate"><span class="pre">MyGameEngineCharacterHead</span></code>,
which provides a reference pose (see <a class="reference internal" href="../features/sim_game_camera.html#about-sim-game-camera-controlling-the-in-game-camera"><span class="std std-ref">Control the in-game camera movement</span></a>);</p></li>
<li><p>Both the <code class="docutils literal notranslate"><span class="pre">MyGameEngineImmersiveCamera</span></code> and <code class="docutils literal notranslate"><span class="pre">MyGameEngineCharacterHead</span></code> instances hold pointers of the <code class="docutils literal notranslate"><span class="pre">MyGameEngineBeamEyeTrackerDevice</span></code>
instance so that they react to eye and head tracking data at the <code class="docutils literal notranslate"><span class="pre">Tick</span></code> function;</p></li>
<li><p>Implements a <code class="docutils literal notranslate"><span class="pre">MyGameEngineHotkeysMapper</span></code> which monitors if the user presses the SPACE key to recenter the camera,
following <a class="reference internal" href="../features/sim_game_camera.html#about-camera-recentering"><span class="std std-ref">Implement the camera recentering</span></a>;</p></li>
</ul>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">main.cpp</span><a class="headerlink" href="#id4" title="Link to this code"><span>¶</span></a></div>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><code><span id="line-1"><span class="linenos">  1</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"bet_game_engine_device.h"</span>
</span><span id="line-2"><span class="linenos">  2</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">"my_game_engine.h"</span>
</span><span id="line-3"><span class="linenos">  3</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
</span><span id="line-4"><span class="linenos">  4</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iomanip&gt;</span>
</span><span id="line-5"><span class="linenos">  5</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
</span><span id="line-6"><span class="linenos">  6</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;thread&gt;</span>
</span><span id="line-7"><span class="linenos">  7</span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;windows.h&gt;</span>
</span><span id="line-8"><span class="linenos">  8</span><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-9"><span class="linenos">  9</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*&gt;</span><span class="w"> </span><span class="n">devices</span><span class="p">;</span>
</span><span id="line-10"><span class="linenos"> 10</span><span class="p">}</span>
</span><span id="line-11"><span class="linenos"> 11</span>
</span><span id="line-12"><span class="linenos"> 12</span><span class="c1">// See bet_game_engine_device.h for showing the "integration" of the Beam API as a device in the</span>
</span><span id="line-13"><span class="linenos"> 13</span><span class="c1">// engine See this file to see how it interacts with the other objects in the engine.</span>
</span><span id="line-14"><span class="linenos"> 14</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineImmersiveHUD</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-15"><span class="linenos"> 15</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-16"><span class="linenos"> 16</span><span class="w">    </span><span class="n">MyGameEngineImmersiveHUD</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-17"><span class="linenos"> 17</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-18"><span class="linenos"> 18</span>
</span><span id="line-19"><span class="linenos"> 19</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-20"><span class="linenos"> 20</span><span class="w">        </span><span class="c1">// Get a reference to the Beam Eye Tracker device.</span>
</span><span id="line-21"><span class="linenos"> 21</span><span class="w">        </span><span class="n">beam_eye_tracker_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">devices</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span id="line-22"><span class="linenos"> 22</span>
</span><span id="line-23"><span class="linenos"> 23</span><span class="w">        </span><span class="c1">// Dummy hud ui_elements added to all corners</span>
</span><span id="line-24"><span class="linenos"> 24</span><span class="w">        </span><span class="n">ui_elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">MyGameEngineHUDElement</span><span class="p">{</span><span class="n">MyGameEngineHUDElement</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">TOP_LEFT</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">});</span>
</span><span id="line-25"><span class="linenos"> 25</span><span class="w">        </span><span class="n">ui_elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span><span id="line-26"><span class="linenos"> 26</span><span class="w">            </span><span class="n">MyGameEngineHUDElement</span><span class="p">{</span><span class="n">MyGameEngineHUDElement</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">TOP_RIGHT</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">});</span>
</span><span id="line-27"><span class="linenos"> 27</span><span class="w">        </span><span class="n">ui_elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span><span id="line-28"><span class="linenos"> 28</span><span class="w">            </span><span class="n">MyGameEngineHUDElement</span><span class="p">{</span><span class="n">MyGameEngineHUDElement</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BOTTOM_LEFT</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">});</span>
</span><span id="line-29"><span class="linenos"> 29</span><span class="w">        </span><span class="n">ui_elements</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span>
</span><span id="line-30"><span class="linenos"> 30</span><span class="w">            </span><span class="n">MyGameEngineHUDElement</span><span class="p">{</span><span class="n">MyGameEngineHUDElement</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">BOTTOM_RIGHT</span><span class="p">,</span><span class="w"> </span><span class="k">this</span><span class="p">});</span>
</span><span id="line-31"><span class="linenos"> 31</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-32"><span class="linenos"> 32</span><span class="w">    </span><span class="c1">// Implemented in bet_game_engine_device.cpp to identify</span>
</span><span id="line-33"><span class="linenos"> 33</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-34"><span class="linenos"> 34</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">element</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">ui_elements</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-35"><span class="linenos"> 35</span><span class="w">            </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">element</span><span class="p">.</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-36"><span class="linenos"> 36</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">MyGameEngineHUDElement</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">TOP_LEFT</span><span class="p">:</span>
</span><span id="line-37"><span class="linenos"> 37</span><span class="w">                </span><span class="n">element</span><span class="p">.</span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">device_output_top_left_hud_opacity</span><span class="p">;</span>
</span><span id="line-38"><span class="linenos"> 38</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="line-39"><span class="linenos"> 39</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">MyGameEngineHUDElement</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">TOP_RIGHT</span><span class="p">:</span>
</span><span id="line-40"><span class="linenos"> 40</span><span class="w">                </span><span class="n">element</span><span class="p">.</span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">device_output_top_right_hud_opacity</span><span class="p">;</span>
</span><span id="line-41"><span class="linenos"> 41</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="line-42"><span class="linenos"> 42</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">MyGameEngineHUDElement</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">BOTTOM_LEFT</span><span class="p">:</span>
</span><span id="line-43"><span class="linenos"> 43</span><span class="w">                </span><span class="n">element</span><span class="p">.</span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">device_output_bottom_left_hud_opacity</span><span class="p">;</span>
</span><span id="line-44"><span class="linenos"> 44</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="line-45"><span class="linenos"> 45</span><span class="w">            </span><span class="k">case</span><span class="w"> </span><span class="no">MyGameEngineHUDElement</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">BOTTOM_RIGHT</span><span class="p">:</span>
</span><span id="line-46"><span class="linenos"> 46</span><span class="w">                </span><span class="n">element</span><span class="p">.</span><span class="n">opacity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">device_output_bottom_right_hud_opacity</span><span class="p">;</span>
</span><span id="line-47"><span class="linenos"> 47</span><span class="w">                </span><span class="k">break</span><span class="p">;</span>
</span><span id="line-48"><span class="linenos"> 48</span><span class="w">            </span><span class="p">}</span>
</span><span id="line-49"><span class="linenos"> 49</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-50"><span class="linenos"> 50</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-51"><span class="linenos"> 51</span>
</span><span id="line-52"><span class="linenos"> 52</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">MyGameEngineHUDElement</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ui_elements</span><span class="p">;</span>
</span><span id="line-53"><span class="linenos"> 53</span>
</span><span id="line-54"><span class="linenos"> 54</span><span class="w">    </span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*</span><span class="n">beam_eye_tracker_device</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span>
</span><span id="line-55"><span class="linenos"> 55</span><span class="p">};</span>
</span><span id="line-56"><span class="linenos"> 56</span>
</span><span id="line-57"><span class="linenos"> 57</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineImmersiveCamera</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-58"><span class="linenos"> 58</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-59"><span class="linenos"> 59</span><span class="w">    </span><span class="n">MyGameEngineImmersiveCamera</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-60"><span class="linenos"> 60</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-61"><span class="linenos"> 61</span>
</span><span id="line-62"><span class="linenos"> 62</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-63"><span class="linenos"> 63</span><span class="w">        </span><span class="c1">// Get a reference to the Beam Eye Tracker device.</span>
</span><span id="line-64"><span class="linenos"> 64</span><span class="w">        </span><span class="n">beam_eye_tracker_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">devices</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span id="line-65"><span class="linenos"> 65</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-66"><span class="linenos"> 66</span>
</span><span id="line-67"><span class="linenos"> 67</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-68"><span class="linenos"> 68</span><span class="w">        </span><span class="c1">// Updates the local pose.</span>
</span><span id="line-69"><span class="linenos"> 69</span><span class="w">        </span><span class="c1">// What is critical to notice is that this updates the world_transform by adding up the</span>
</span><span id="line-70"><span class="linenos"> 70</span><span class="w">        </span><span class="c1">// parent's world_transform with the now given local_transform.</span>
</span><span id="line-71"><span class="linenos"> 71</span><span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">set_local_transform</span><span class="p">(</span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">device_output_camera_local_transform</span><span class="p">);</span>
</span><span id="line-72"><span class="linenos"> 72</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-73"><span class="linenos"> 73</span>
</span><span id="line-74"><span class="linenos"> 74</span><span class="w">    </span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*</span><span class="n">beam_eye_tracker_device</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span>
</span><span id="line-75"><span class="linenos"> 75</span><span class="p">};</span>
</span><span id="line-76"><span class="linenos"> 76</span>
</span><span id="line-77"><span class="linenos"> 77</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineHotkeysMapper</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-78"><span class="linenos"> 78</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-79"><span class="linenos"> 79</span><span class="w">    </span><span class="n">MyGameEngineHotkeysMapper</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-80"><span class="linenos"> 80</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-81"><span class="linenos"> 81</span>
</span><span id="line-82"><span class="linenos"> 82</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">BeginPlay</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-83"><span class="linenos"> 83</span><span class="w">        </span><span class="c1">// Get a reference to the Beam Eye Tracker device.</span>
</span><span id="line-84"><span class="linenos"> 84</span><span class="w">        </span><span class="n">beam_eye_tracker_device</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">dynamic_cast</span><span class="o">&lt;</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*&gt;</span><span class="p">(</span><span class="n">devices</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span><span id="line-85"><span class="linenos"> 85</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-86"><span class="linenos"> 86</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-87"><span class="linenos"> 87</span><span class="w">        </span><span class="c1">// Check if R key is pressed</span>
</span><span id="line-88"><span class="linenos"> 88</span><span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="n">recenter_key_pressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetAsyncKeyState</span><span class="p">(</span><span class="n">VK_SPACE</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="mh">0x8000</span><span class="p">;</span>
</span><span id="line-89"><span class="linenos"> 89</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">recenter_key_pressed</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">was_recenter_key_pressed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-90"><span class="linenos"> 90</span><span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">recenter_key_pressed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-91"><span class="linenos"> 91</span><span class="w">                </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">recenter_camera_start</span><span class="p">();</span>
</span><span id="line-92"><span class="linenos"> 92</span><span class="w">            </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-93"><span class="linenos"> 93</span><span class="w">                </span><span class="n">beam_eye_tracker_device</span><span class="o">-&gt;</span><span class="n">recenter_camera_end</span><span class="p">();</span>
</span><span id="line-94"><span class="linenos"> 94</span><span class="w">            </span><span class="p">}</span>
</span><span id="line-95"><span class="linenos"> 95</span><span class="w">            </span><span class="n">was_recenter_key_pressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recenter_key_pressed</span><span class="p">;</span>
</span><span id="line-96"><span class="linenos"> 96</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-97"><span class="linenos"> 97</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-98"><span class="linenos"> 98</span>
</span><span id="line-99"><span class="linenos"> 99</span><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">was_recenter_key_pressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="line-100"><span class="linenos">100</span><span class="w">    </span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="w"> </span><span class="o">*</span><span class="n">beam_eye_tracker_device</span><span class="p">{</span><span class="k">nullptr</span><span class="p">};</span>
</span><span id="line-101"><span class="linenos">101</span><span class="p">};</span>
</span><span id="line-102"><span class="linenos">102</span>
</span><span id="line-103"><span class="linenos">103</span><span class="k">class</span><span class="w"> </span><span class="nc">MyGameEngineCharacterHead</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-104"><span class="linenos">104</span><span class="w">  </span><span class="k">public</span><span class="o">:</span>
</span><span id="line-105"><span class="linenos">105</span><span class="w">    </span><span class="n">MyGameEngineCharacterHead</span><span class="p">(</span><span class="n">MyGameEngineObjectInterface</span><span class="w"> </span><span class="o">*</span><span class="n">parent</span><span class="p">)</span>
</span><span id="line-106"><span class="linenos">106</span><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">MyGameEngineObjectInterface</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
</span><span id="line-107"><span class="linenos">107</span>
</span><span id="line-108"><span class="linenos">108</span><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-109"><span class="linenos">109</span><span class="w">        </span><span class="c1">// Just pretend the character is moving forward very slowly.</span>
</span><span id="line-110"><span class="linenos">110</span><span class="w">        </span><span class="k">this</span><span class="o">-&gt;</span><span class="n">world_transform</span><span class="p">.</span><span class="n">translation_z_inches</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">0.01f</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">M_METERS_TO_INCHES</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">delta_time</span><span class="p">;</span>
</span><span id="line-111"><span class="linenos">111</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-112"><span class="linenos">112</span><span class="p">};</span>
</span><span id="line-113"><span class="linenos">113</span>
</span><span id="line-114"><span class="linenos">114</span><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-115"><span class="linenos">115</span><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">beam_eye_tracker_device</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-116"><span class="linenos">116</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">MyGameEngineBeamEyeTrackerDevice</span><span class="o">&gt;</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="line-117"><span class="linenos">117</span><span class="w">    </span><span class="n">devices</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">beam_eye_tracker_device</span><span class="p">.</span><span class="n">get</span><span class="p">());</span>
</span><span id="line-118"><span class="linenos">118</span>
</span><span id="line-119"><span class="linenos">119</span><span class="w">    </span><span class="c1">// Basic components, whose parent will be ignored as that's irrelevant in this sample.</span>
</span><span id="line-120"><span class="linenos">120</span><span class="w">    </span><span class="n">MyGameEngineCharacterHead</span><span class="w"> </span><span class="n">character_head</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="line-121"><span class="linenos">121</span><span class="w">    </span><span class="n">MyGameEngineImmersiveHUD</span><span class="w"> </span><span class="n">immersive_hud</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="line-122"><span class="linenos">122</span><span class="w">    </span><span class="n">MyGameEngineHotkeysMapper</span><span class="w"> </span><span class="n">hotkeys_mapper</span><span class="p">(</span><span class="k">nullptr</span><span class="p">);</span>
</span><span id="line-123"><span class="linenos">123</span><span class="w">    </span><span class="n">MyGameEngineImmersiveCamera</span><span class="w"> </span><span class="n">immersive_camera</span><span class="p">(</span><span class="o">&amp;</span><span class="n">character_head</span><span class="p">);</span>
</span><span id="line-124"><span class="linenos">124</span>
</span><span id="line-125"><span class="linenos">125</span><span class="w">    </span><span class="c1">// We could put all in a list, but will be made explicit for clarity.</span>
</span><span id="line-126"><span class="linenos">126</span>
</span><span id="line-127"><span class="linenos">127</span><span class="w">    </span><span class="c1">//============= INITIALIZING THE GAME RENDERING =============</span>
</span><span id="line-128"><span class="linenos">128</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-129"><span class="linenos">129</span><span class="w">        </span><span class="c1">// Initializes the Beam device and API</span>
</span><span id="line-130"><span class="linenos">130</span><span class="w">        </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">BeginPlay</span><span class="p">();</span>
</span><span id="line-131"><span class="linenos">131</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-132"><span class="linenos">132</span><span class="w">    </span><span class="n">hotkeys_mapper</span><span class="p">.</span><span class="n">BeginPlay</span><span class="p">();</span>
</span><span id="line-133"><span class="linenos">133</span><span class="w">    </span><span class="n">immersive_hud</span><span class="p">.</span><span class="n">BeginPlay</span><span class="p">();</span>
</span><span id="line-134"><span class="linenos">134</span><span class="w">    </span><span class="n">immersive_camera</span><span class="p">.</span><span class="n">BeginPlay</span><span class="p">();</span>
</span><span id="line-135"><span class="linenos">135</span><span class="w">    </span><span class="n">character_head</span><span class="p">.</span><span class="n">BeginPlay</span><span class="p">();</span>
</span><span id="line-136"><span class="linenos">136</span>
</span><span id="line-137"><span class="linenos">137</span><span class="w">    </span><span class="c1">//============= FRAME LOOP at 60 FPS =============</span>
</span><span id="line-138"><span class="linenos">138</span><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">prev_frame_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="line-139"><span class="linenos">139</span><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="w"> </span><span class="n">end_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">prev_frame_time</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">seconds</span><span class="p">(</span><span class="mi">30</span><span class="p">);</span><span class="w"> </span><span class="c1">// Run for 30 seconds.</span>
</span><span id="line-140"><span class="linenos">140</span><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">end_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-141"><span class="linenos">141</span><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">frame_start</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">system_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
</span><span id="line-142"><span class="linenos">142</span><span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="w"> </span><span class="o">=</span>
</span><span id="line-143"><span class="linenos">143</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">duration</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">frame_start</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">prev_frame_time</span><span class="p">).</span><span class="n">count</span><span class="p">();</span>
</span><span id="line-144"><span class="linenos">144</span><span class="w">        </span><span class="n">prev_frame_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">frame_start</span><span class="p">;</span>
</span><span id="line-145"><span class="linenos">145</span>
</span><span id="line-146"><span class="linenos">146</span><span class="w">        </span><span class="n">hotkeys_mapper</span><span class="p">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-147"><span class="linenos">147</span><span class="w">        </span><span class="c1">// We assume that devices are updated before the HUD and camera.</span>
</span><span id="line-148"><span class="linenos">148</span><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-149"><span class="linenos">149</span><span class="w">            </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">Tick</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-150"><span class="linenos">150</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-151"><span class="linenos">151</span><span class="w">        </span><span class="c1">// In theory, here the parent-child relationship would drive the ordering, but we'll just</span>
</span><span id="line-152"><span class="linenos">152</span><span class="w">        </span><span class="c1">// fake it by updating the character head first, then the camera, then the HUD.</span>
</span><span id="line-153"><span class="linenos">153</span><span class="w">        </span><span class="n">character_head</span><span class="p">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-154"><span class="linenos">154</span><span class="w">        </span><span class="n">immersive_hud</span><span class="p">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-155"><span class="linenos">155</span>
</span><span id="line-156"><span class="linenos">156</span><span class="w">        </span><span class="n">immersive_camera</span><span class="p">.</span><span class="n">Tick</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
</span><span id="line-157"><span class="linenos">157</span>
</span><span id="line-158"><span class="linenos">158</span><span class="w">        </span><span class="c1">// Note: if you want to see "real" responses for the top-left HUD element opacity when you</span>
</span><span id="line-159"><span class="linenos">159</span><span class="w">        </span><span class="c1">// look to the top-left corner of your display, please edit</span>
</span><span id="line-160"><span class="linenos">160</span><span class="w">        </span><span class="c1">// MyGameEngineBeamEyeTrackerDevice::get_rendering_area_viewport_geometry_from_engine and</span>
</span><span id="line-161"><span class="linenos">161</span><span class="w">        </span><span class="c1">// hard-code the correct geometry of your display.</span>
</span><span id="line-162"><span class="linenos">162</span>
</span><span id="line-163"><span class="linenos">163</span><span class="w">        </span><span class="c1">// Note: you should see the printed z values to grow slowly as the character head is moving</span>
</span><span id="line-164"><span class="linenos">164</span><span class="w">        </span><span class="c1">// forward slowly, but also increase or decrease in values as you move towards or away from</span>
</span><span id="line-165"><span class="linenos">165</span><span class="w">        </span><span class="c1">// the webcam. Press SPACE to recenter the camera.</span>
</span><span id="line-166"><span class="linenos">166</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"[Game cam: z_pos_inches="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fixed</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-167"><span class="linenos">167</span><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">immersive_camera</span><span class="p">.</span><span class="n">world_transform</span><span class="p">.</span><span class="n">translation_z_inches</span>
</span><span id="line-168"><span class="linenos">168</span><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" ; yaw_degrees="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fixed</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-169"><span class="linenos">169</span><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">immersive_camera</span><span class="p">.</span><span class="n">world_transform</span><span class="p">.</span><span class="n">rotation_y_degrees</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"] and ["</span>
</span><span id="line-170"><span class="linenos">170</span><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"HUD top left opacity="</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">fixed</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">setprecision</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span id="line-171"><span class="linenos">171</span><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">immersive_hud</span><span class="p">.</span><span class="n">ui_elements</span><span class="p">.</span><span class="n">at</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">opacity</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">"]"</span><span class="p">;</span>
</span><span id="line-172"><span class="linenos">172</span><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hotkeys_mapper</span><span class="p">.</span><span class="n">was_recenter_key_pressed</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-173"><span class="linenos">173</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">" Recentering!"</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="line-174"><span class="linenos">174</span><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-175"><span class="linenos">175</span><span class="w">            </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span><span id="line-176"><span class="linenos">176</span><span class="w">        </span><span class="p">}</span>
</span><span id="line-177"><span class="linenos">177</span>
</span><span id="line-178"><span class="linenos">178</span><span class="w">        </span><span class="c1">// Sleep for 16ms to simulate 60-ish FPS</span>
</span><span id="line-179"><span class="linenos">179</span><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep_for</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">milliseconds</span><span class="p">(</span><span class="mi">16</span><span class="p">));</span>
</span><span id="line-180"><span class="linenos">180</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-181"><span class="linenos">181</span><span class="w">    </span><span class="c1">//============= SHUTTING DOWN THE GAME RENDERING =============</span>
</span><span id="line-182"><span class="linenos">182</span><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="o">&amp;</span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="line-183"><span class="linenos">183</span><span class="w">        </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">EndPlay</span><span class="p">();</span><span class="w"> </span><span class="c1">// Shuts down the Beam device and API</span>
</span><span id="line-184"><span class="linenos">184</span><span class="w">    </span><span class="p">}</span>
</span><span id="line-185"><span class="linenos">185</span><span class="w">    </span><span class="n">immersive_hud</span><span class="p">.</span><span class="n">EndPlay</span><span class="p">();</span>
</span><span id="line-186"><span class="linenos">186</span><span class="w">    </span><span class="n">immersive_camera</span><span class="p">.</span><span class="n">EndPlay</span><span class="p">();</span>
</span><span id="line-187"><span class="linenos">187</span><span class="w">    </span><span class="n">character_head</span><span class="p">.</span><span class="n">EndPlay</span><span class="p">();</span>
</span><span id="line-188"><span class="linenos">188</span><span class="p">}</span>
</span></code></pre></div>
</div>
</div>
</section>
</section>
<section id="other-highlights">
<h2>Other highlights<a class="headerlink" href="#other-highlights" title="Link to this heading" x-intersect.margin.0%.0%.-70%.0%="activeSection = '#other-highlights'"><span>¶</span></a></h2>
<ul class="simple">
<li><p>The sample assumes that the game engine is using a Unity-like coordinate system for the camera pose (yaw, pitch, roll, x, y, z definitions)
and viewport geometry (origin <code class="docutils literal notranslate"><span class="pre">(0,</span> <span class="pre">0)</span></code> at bottom-left corner of the rendering area).</p></li>
<li><p>The demonstrated game settings are head tracking sensitivity, eye tracking sensitivity and auto-start behavior toggle,
which would typically be exposed in the game’s UI.</p></li>
<li><p>Note how the opacity fade in and fade out is <cite>animated</cite> to make a smoother experience, but fade in is much faster than fade out.</p></li>
</ul>
</section>
</section>
</div><div class="flex justify-between items-center pt-6 mt-12 border-t border-border gap-4">
<div class="mr-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="integration.html">
<svg class="mr-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="15 18 9 12 15 6"></polyline>
</svg>
        Plugins and samples
      </a>
</div>
<div class="ml-auto">
<a class="inline-flex items-center justify-center rounded-md text-sm font-medium transition-colors border border-input hover:bg-accent hover:text-accent-foreground py-2 px-4" href="unity.html">
        Unity Package
        <svg class="ml-2 h-4 w-4" fill="none" height="24" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewbox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
<polyline points="9 18 15 12 9 6"></polyline>
</svg>
</a>
</div>
</div></div><aside class="hidden text-sm xl:block" id="right-sidebar">
<div class="sticky top-16 -mt-10 max-h-[calc(100vh-5rem)] overflow-y-auto pt-6 space-y-2"><p class="font-medium">On this page</p>
<ul>
<li><a :data-current="activeSection === '#compiling-and-running-the-sample'" class="reference internal" href="#compiling-and-running-the-sample">Compiling and running the sample</a></li>
<li><a :data-current="activeSection === '#sample-explained'" class="reference internal" href="#sample-explained">Sample explained</a><ul>
<li><a :data-current="activeSection === '#my-game-engine-h'" class="reference internal" href="#my-game-engine-h">my_game_engine.h</a></li>
<li><a :data-current="activeSection === '#bet-game-engine-device-h'" class="reference internal" href="#bet-game-engine-device-h">bet_game_engine_device.h</a></li>
<li><a :data-current="activeSection === '#main-cpp'" class="reference internal" href="#main-cpp">main.cpp</a></li>
</ul>
</li>
<li><a :data-current="activeSection === '#other-highlights'" class="reference internal" href="#other-highlights">Other highlights</a></li>
</ul>
</div>
</aside>
</main>
</div>
</div><footer class="py-6 border-t border-border md:py-0">
<div class="container flex flex-col items-center justify-between gap-4 md:h-24 md:flex-row">
<div class="flex flex-col items-center gap-4 px-8 md:flex-row md:gap-2 md:px-0">
<p class="text-sm leading-loose text-center text-muted-foreground md:text-left">© 2025, Eyeware Tech SA Built with <a class="font-medium underline underline-offset-4" href="https://www.sphinx-doc.org" rel="noreferrer">Sphinx 8.2.3</a></p>
</div>
</div>
</footer>
</div>
<script src="../_static/documentation_options.js?v=5929fcd5"></script>
<script src="../_static/doctools.js?v=9bcbadda"></script>
<script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
<script defer="defer" src="../_static/theme.js?v=073f68d9"></script>
<script src="../_static/design-tabs.js?v=f930bc37"></script>
</body>
</html>